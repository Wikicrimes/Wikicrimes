<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:t="http://myfaces.apache.org/tomahawk"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j">

<head>
<link rel="stylesheet" href="./styles/modal-message.css" type="text/css" />
<script type="text/javascript" src="./scripts/modal-message.js"></script>
<link rel="alternate" type="application/rss+xml"
	title="#{messages['rss.titulo']}" href="#{request.contextPath}/rss" />
</head>

<body>
<t:panelGroup id="painelPrincipaLoginLogout">
	<c:if test="#{empty usuario}">
		<table align="right" cellpadding="1" cellspacing="0" border="0">
			<tr>
				<td width="40px"></td>
				<td><h:outputLink value="#"
					onclick="displayMessage('./login.html', 300, 245,'Login');return false">
					<h:outputText value="Login" />
				</h:outputLink> |</td>
				<td><h:outputLink value="#"
					onclick="displayMessage('./registrarUsuario.html', 600, 350,'#{messages['usuario.registrar']}');return false;">
					<h:outputText value="#{messages['usuario.registre']}" />
				</h:outputLink></td>

			</tr>
			<tr>
				<td colspan="3">
				<div align="right"><br />
				<br />
				<h:outputText
					value="#{filtroForm.quantidadeCrimes} #{messages['titulo.crimesRegistrados']}"
					style="font-size:12px; font-weight: bold; text-align: center; margin-top: 2px;" />
				</div>
				</td>
			</tr>

		</table>

	</c:if>
	<c:if test="#{not empty usuario}">
		<h:form>

			<table align="right" border="0" cellspacing="0" cellpadding="1">
				<tr>
					<td width="40px"></td>

					<td><h:outputText value="#{usuario.email} " /></td>
					<td>|</td>
					<td><a4j:commandLink value=" Logout "
						reRender="pesquisaGenerica, painelPrincipaLoginLogout, divMobile"
						action="#{usuarioForm.logout}" immediate="true"
						onclick="onLogout()" /></td>
					<td>|</td>
					<!--  
					<td><h:outputLink value="#"
						onclick="displayMessage('./mostrarReputacao.html', 1000, 392,'#{messages['usuario.reputacao']}');return false">
						<h:outputText
							value=" #{messages['usuario.reputacao']} "
							title="#{messages['usuario.reputacao.hint']}" />
					</h:outputLink></td>
					<td>|</td> -->

					<td><h:outputLink value="#"
						onclick="displayMessage('./listarAreas.html', 420, 200,'#{messages['webapp.area.titulo.minhasareas']}');return false">
						<h:outputText
							value=" #{messages['webapp.area.titulo.minhasareas']} "
							title="#{messages['webapp.area.titulo.minhasareas']}" />
					</h:outputLink></td>
					<td>|</td>

					<td><h:outputLink value="#"
						onclick="displayMessage('./listarCrimes.html', 800, 350,'#{messages['usuario.denuncias']}');return false">
						<h:outputText value=" #{messages['usuario.denuncias']} "
							title="#{messages['usuario.denuncias.hint']}" />
					</h:outputLink></td>
					<td>|</td>
					<td><h:outputLink value="#"
						onclick="displayMessage('./editarPreferencias.html', 650, 400,'#{messages['usuario.conta']}');return false">
						<h:outputText value=" #{messages['usuario.conta']} "
							title="#{messages['usuario.conta.hint']}" />
					</h:outputLink></td>

				</tr>
				<tr valign="top">
					<td colspan="10">
					<div align="right"><br />
					<br />
					<h:outputText
						value="#{filtroForm.quantidadeCrimes} #{messages['titulo.crimesRegistrados']}"
						style="font-size:12px; font-weight: bold; text-align: center; margin-top: 2px;" />
					</div>
					</td>
				</tr>
			</table>
		</h:form>

	</c:if>


	<h:form id="formReRenderRegistroCrimes">
		<a4j:commandButton id="btRegistroCrimeSubmit"
			reRender="panelRegistroCrime" style="display: none" />
	</h:form>
	<h:form id="formReRenderRegistroDenuncia">
		<a4j:commandButton id="btRegistroDenunciaSubmit"
			reRender="panelRegistroDenuncia" style="display: none" />
	</h:form>
	<h:form id="formDesabilitaTutor">
		<a4j:commandButton id="btDesabilitaTutor"
			action="#{filtroForm.desabilitaTutor}" style="display: none" />
	</h:form>
	<h:form id="formReRenderLogin">
		<a4j:commandButton id="btLoginSubmit"
			reRender="pesquisaGenerica, painelPrincipaLoginLogout,divMobile"
			style="display: none" />
	</h:form>
	<h:form id="formDownloadMobile">
		<h:commandButton id="btInstrucoesMobile"
			action="#{usuarioForm.mostraPaginaInstrucoes}" style="display: none" />
	</h:form>

	<script>
			/* <![CDATA[ */
				
				function loginCasoPrecise(tipo, msg){
					var precisaLogin = #{usuario == null}; 
					if(precisaLogin)
						displayMessage('./login.html?mensagemLogin=' + msg + '&amp;'+
								'tipoRegistro='+tipo,300, 245,'Login');
					return precisaLogin;
				}

				function onLogout(){
		//*********************** AREAS RISCO INICIO ****************************
		//pra esconder as areas de risco do usuario q fez logoff e 
		//forcar de carregar areas novamente qd o proximo usuario q fizer login 					
					limparMinhasAreas();
		//*********************** AREAS RISCO FIM ****************************
				}
			
				function usuarioEstaLogado(){				
					if(#{usuario != null})
						return true;
					else
						return false;				
				}
				function registrarArea1(){ 			
					if(#{usuario != null}){
						selecionarComando(map, 'area');
				  		//document.getElementById("divExplicaMarcarArea").style.visibility = "visible";
				  		estaRegistrandoArea = true;
					    startShape();
					}
					else{
						displayMessage('./login.html?mensagemLogin=#{messages["usuario.informacao.area"]}&amp;tipoRegistro=3',300, 245,'Login');
					}
				}

				function gerarEmbedded(){
					if(#{usuario != null}){
						displayMessage('./geradorEmbedded.html', 900, 510,'#{messages["mapaEmbedded.estado.mapa"]}');
					}else{
						displayMessage('./login.html',300, 245,'Login');
					}	
				}


				var comandoControleMao = new ComandoMao();
				var comandoControleMaoSelecionado = new ComandoMaoSelecionado();
				var comandoControleKML = new ComandoKML();
				var comandoControleMarcadorDeArea = new ComandoMarcadorDeArea();
				var comandoControleMarcadorDeAreaSelecionado = new ComandoMarcadorDeAreaSelecionado();
				//var comandoControleEmbed = new ComandoEmbed();	
				//var comandoControleEmbedSelecionado = new ComandoEmbedSelecionado();
				var comandoControleFiltro = new ComandoFiltro();	
				var comandoControleFiltroSelecionado = new ComandoFiltroSelecionado();
				var comandoControleKernel = new ComandoKernel();
				var comandoControleKernelSelecionado = new ComandoKernelSelecionado();
				function selecionarComando(mapa, comando, off){

						//alert('comando: ' + comando + ', off:' + off);

						mapa.removeControl(comandoControleMao);
						mapa.removeControl(comandoControleMaoSelecionado);
						mapa.removeControl(comandoControleMarcadorDeArea);
						mapa.removeControl(comandoControleMarcadorDeAreaSelecionado);
						//mapa.removeControl(comandoControleEmbed);
						//mapa.removeControl(comandoControleEmbedSelecionado);
						mapa.removeControl(comandoControleFiltro);
						mapa.removeControl(comandoControleFiltroSelecionado);
						mapa.removeControl(comandoControleKML);
						//mapa.removeControl(comandoControleKernel);
						//mapa.removeControl(comandoControleKernelSelecionado);


						if(comando=='kml'){					
							mapa.addControl(comandoControleMarcadorDeArea);
							mapa.addControl(comandoControleMao);
							mapa.addControl(comandoControleFiltro);
							mapa.addControl(comandoControleKML);
							//mapa.addControl(comandoControleKernel);
							if(#{usuario.perfil.nome == 'CERTIFICADOR'}||#{usuario.perfil.nome == 'ADMINISTRADOR'}){
								if(#{usuario.entidadeCertificadora.idEntidadeCertificadora != 12}){
									//mapa.addControl(comandoControleEmbed);
								}	
							}
						}
						
						
						if(comando=='filtro'){					
							mapa.addControl(comandoControleMarcadorDeArea);
							mapa.addControl(comandoControleMao);
							mapa.addControl(comandoControleKML);
							//mapa.addControl(comandoControleKernel);
							mapa.addControl(comandoControleFiltroSelecionado);
							if(#{usuario.perfil.nome == 'CERTIFICADOR'}||#{usuario.perfil.nome == 'ADMINISTRADOR'}){
								if(#{usuario.entidadeCertificadora.idEntidadeCertificadora != 12}){
									//mapa.addControl(comandoControleEmbed);
								}	
							}
						}

						if(comando=='kernel'){
							if(off){
								mapa.removeControl(comandoControleKernelSelecionado);
								mapa.addControl(comandoControleKernel);
							}else{
								mapa.removeControl(comandoControleKernel);
								mapa.addControl(comandoControleKernelSelecionado);
							}
							mapa.addControl(comandoControleMarcadorDeArea);
							mapa.addControl(comandoControleMao);
							mapa.addControl(comandoControleKML);
							mapa.addControl(comandoControleFiltro);
							if(#{usuario.perfil.nome == 'CERTIFICADOR'}||#{usuario.perfil.nome == 'ADMINISTRADOR'}){
								if(#{usuario.entidadeCertificadora.idEntidadeCertificadora != 12}){
									//mapa.addControl(comandoControleEmbed);
								}	
							}
						}
						
						if(comando=='mao'){											
							mapa.addControl(comandoControleMarcadorDeArea);
							mapa.addControl(comandoControleMaoSelecionado);
							mapa.addControl(comandoControleKML);
							if(!kernelEnable)
								mapa.addControl(comandoControleKernel);
							mapa.addControl(comandoControleFiltro);
							if(#{usuario.perfil.nome == 'CERTIFICADOR'}||#{usuario.perfil.nome == 'ADMINISTRADOR'}){
								if(#{usuario.entidadeCertificadora.idEntidadeCertificadora != 12}){
									//mapa.addControl(comandoControleEmbed);
								}	
							}
						}
						if(comando == 'area'){
							document.getElementById("divTelaFiltro").style.visibility = "hidden";					
							mapa.addControl(comandoControleMarcadorDeAreaSelecionado);
							mapa.addControl(comandoControleMao);
							//mapa.addControl(comandoControleKernel);
							mapa.addControl(comandoControleFiltro);
							mapa.addControl(comandoControleKML);
							if(#{usuario.perfil.nome == 'CERTIFICADOR'}||#{usuario.perfil.nome == 'ADMINISTRADOR'}){
								if(#{usuario.entidadeCertificadora.idEntidadeCertificadora != 12}){
									//mapa.addControl(comandoControleEmbed);
								}	
							}
						}
						if(comando == 'nenhum'){
							document.getElementById("divTelaKML").style.visibility = "hidden";
							document.getElementById("divTelaFiltro").style.visibility = "hidden";
							mapa.addControl(comandoControleMarcadorDeArea);
							mapa.addControl(comandoControleMao);
							mapa.addControl(comandoControleKernel);
							mapa.addControl(comandoControleFiltro);
							mapa.addControl(comandoControleKML);
							if(#{usuario.perfil.nome == 'CERTIFICADOR'}||#{usuario.perfil.nome == 'ADMINISTRADOR'}){
								if(#{usuario.entidadeCertificadora.idEntidadeCertificadora != 12}){
									//mapa.addControl(comandoControleEmbed);
								}	
							}
						}
						if(comando == 'embed'){
							document.getElementById("divTelaKML").style.visibility = "hidden";
							document.getElementById("divTelaFiltro").style.visibility = "hidden";
							mapa.addControl(comandoControleMarcadorDeArea);
							mapa.addControl(comandoControleMao);
							mapa.addControl(comandoControleKML);
							mapa.addControl(comandoControleKernel);
							mapa.addControl(comandoControleFiltro);
							if(#{usuario.perfil.nome == 'CERTIFICADOR'}||#{usuario.perfil.nome == 'ADMINISTRADOR'}){
								if(#{usuario.entidadeCertificadora.idEntidadeCertificadora != 12}){
									//mapa.addControl(comandoControleEmbed);
								}	
							}
						}
						
				}
				
				try{
						
					selecionarComando(map, 'mao');
				}catch(e){};				
			 /* ]]> */	
			</script>
</t:panelGroup>
</body>
</html>